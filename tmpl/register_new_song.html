<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>新規登録画面</title>

    <style>
        body {
            background: lightgray;
        }

        .divToRegister {
            background-color: silver;
        }
    </style>
</head>


<body>
<div class="divToRegister" align="center">
    <form>
        <table>
            <tr>
                <td>曲名：</td>
                <td><input type="text" id="title" style="margin-right: 20px"></td>
            </tr>
            <tr>
                <td>歌手名：</td>
                <td><input type="text" id="singerName" style="margin-right: 20px"></td>
            </tr>
            <tr>
                <td>mp3ファイル：</td>
                <td><input type="file" id="mp3file" size="30"></td>
            </tr>
        </table>

        <input type="button" id="registerButton" value="新たに登録する" onclick="register()">
    </form>
</div>


<script>
    // 入力された曲名と歌手名が登録登録済みか否か判定する関数
    function searchSingerSong(searchSinger, searchSong) {
        var indexOfSongs = {};
        //初回のみ実行。歌手名がキー、バリューがその歌手の曲名であるインデックスを作る。
        if (/*updated(更新があった) == true*/) { //このままだと曲が追加された時にインデックスを全て（１から）更新←微妙
            for (/* DBの行数回繰り返す */) {
                if (!indexOfSongs[searchSinger]) {
                    indexOfSongs[searchSinger] = [];
                }
                indexOfSongs[searchSinger].push(searchSong);
            }
        }
        //毎回実行。indexOfSongsから キーがsearchSingerで バリューがsearchSongであるデータがあるかどうか判定。
        for(var j in indexOfSongs[searchSinger]){
            if(indexOfSongs[searchSinger][j]==searchSong){
                return true;
            }
        }
        return false;
    }


    //「新たに登録」ボタンを押した時の処理
    function register() {
        var inputtedTitle = document.getElementById("title").value;
        var inputtedSingerName = document.getElementById("singerName").value;
        var inputtedMP3 = document.getElementById("mp3file").value;
        /*
        console.log(inputtedTitle);
        console.log(inputtedSingerName);
        console.log(inputtedMP3);
        */

        if (!inputtedTitle) {
            alert("曲名を入力してください");
        } else {
            if (!inputtedSingerName) {
                alert("歌手名を入力してください");
            } else {
                if (!inputtedMP3) {
                    alert("MP3ファイルを選択してください");
                } else {
                    /*
                    ＜曲名と歌手名を元にDBを検索＞
                    DBがとても大きい時には、DB内すべてを評価していると果てしない時間がかかってしまうのでインデックスを作る。
                    インデックスは{ "singerNameA": ["titleA1","titleA2","titleA3",...],
                                   "singerNameB": ["titleB1","titleB2","titleB3",...],
                                                                                   ...}
                    といった形になる。
                    インデックスの更新のタイミングは新たに歌詞が登録された時とする。
                    歌手名と曲名がわかれば歌詞がわかるので、それをもとに(where singerName, titleで)DB内を検索

                    */
                    if(searchSingerSong(inputtedSingerName, inputtedTitle)){
                        // DBからレコードを取ってくる
                        //取ってきたレコードに対応する画面にフォーカスしておく(とりあえず後で)
                    }else{
                        // 新しい曲をDBに登録する
                        // DBからレコードを取ってくる
                        //updated=true
                    }
                }
            }
        }
    }
</script>


</body>
</html>

